<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>大数据融合追踪!</title>

    <meta name="description" content="Source code generated using layoutit.com">
    <meta name="author" content="LayoutIt!">

    <link href="../src/css/bootstrap.min.css" rel="stylesheet">
    <link href="../src/css/style.css" rel="stylesheet">

  </head>
  <body>

    <div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
			<h1 class="text-center">
				大数据融合追踪
			</h1>
		</div>
	</div>
	<div class="row" >
		<div class="col-md-6" id="track1">
			<h4 class="text-center text-muted">
				过程追踪
			</h4>
			<table id="kkk" class="table table-sm table-bordered">
				<thead>
					<tr>
						<th>
							事务编号
						</th>
						<th>
							契约
						</th>
						<th>
							应用平台
						</th>
						<th>
							时间
						</th>
						<th>
							状态
						</th>
					</tr>
				</thead>
			</table>

		</div>
		<div class="col-md-6" id="track2">
			<h4 class="text-center text-muted">
				结果展示
			</h4>
			<table id="table_ppp" class="table table-sm table-bordered">
                <thead>
                <tr>
                    <th>
                        事务编号
                    </th>
                    <th>
                        契约
                    </th>
                    <th>
                        应用平台
                    </th>
                    <th>
                        时间
                    </th>
                    <th>
                        推送结果
                    </th>
                </tr>
                </thead>
			</table>
		</div>
	</div>
</div>
    <input id="btn" type="button" value="获取表格" />
    <script src="../src/js/jquery.min.js"></script>
    <script src="../src/js/bootstrap.min.js"></script>
    <script src="../src/js/scripts.js"></script>

    <script  type="text/javascript" >
        $(function(){
            $("#btn").bind("click",{btn:$("#btn")},function(evdata){

                $.ajax({
                    type:"POST",
                    dataType:"json",
                    url:"myData.php",
                    timeout:80000,
                    success:function(msg){
                        $("#kkk").remove();
                        $("#track1").append("<table id=\"kkk\" class=\"table table-sm table-bordered\">\n" +
                            "\t\t\t\t<thead>\n" +
                            "\t\t\t\t\t<tr>\n" +
                            "\t\t\t\t\t\t<th>\n" +
                            "\t\t\t\t\t\t\t事务编号\n" +
                            "\t\t\t\t\t\t</th>\n" +
                            "\t\t\t\t\t\t<th>\n" +
                            "\t\t\t\t\t\t\t契约\n" +
                            "\t\t\t\t\t\t</th>\n" +
                            "\t\t\t\t\t\t<th>\n" +
                            "\t\t\t\t\t\t\t应用平台\n" +
                            "\t\t\t\t\t\t</th>\n" +
                            "\t\t\t\t\t\t<th>\n" +
                            "\t\t\t\t\t\t\t时间\n" +
                            "\t\t\t\t\t\t</th>\n" +
                            "\t\t\t\t\t\t<th>\n" +
                            "\t\t\t\t\t\t\t状态\n" +
                            "\t\t\t\t\t\t</th>\n" +
                            "\t\t\t\t\t</tr>\n" +
                            "\t\t\t\t</thead>\n" +
                            "\t\t\t</table>");
                        for(var i =0;i<msg.length;i++)
                        {
                            var k = "";
                           // console.log(msg[i]['status']);
                            switch (msg[i]['status']) {
                                case '01':
                                    k = "契约创建";
                                    break;
                                case "02":
                                    k = "数据归集";
                                    break;
                                case "03":
                                    k = "融合";
                                    break;
                                case "00":
                                    k = "结果推送";
                                    break;
                                default:
                                    k = "未知";
                                    break;

                            }
                            $("#kkk").append("<tr><th>"+msg[i]["xtrans"]+"</th><th>"+msg[i]['name']+"</th><th>"+msg[i]['app_name']+"</th><th>"+msg[i]['createdt']+"</th><th>"+k+"</th></tr>");
                        }
                        //evdata.data.btn.click();
                        $("#btn").click()
                    },
                    error:function(XMLHttpRequest,textStatus,errorThrown){
                        if(textStatus=="timeout"){
                            // $("#msg").append("<br>[超时]");
                            //evdata.data.btn.click();
                            $("#btn").click()
                        }
                    }

                });


                $.ajax({
                    type:"POST",
                    dataType:"json",
                    url:"infoData.php",
                    timeout:80000,
                    success:function(msg){
                        $("#table_ppp").remove();
                        $("#track2").append("<table id=\"table_ppp\" class=\"table table-sm table-bordered\">\n" +
                            "\t\t\t\t<thead>\n" +
                            "\t\t\t\t\t<tr>\n" +
                            "\t\t\t\t\t\t<th>\n" +
                            "\t\t\t\t\t\t\t事务编号\n" +
                            "\t\t\t\t\t\t</th>\n" +
                            "\t\t\t\t\t\t<th>\n" +
                            "\t\t\t\t\t\t\t契约\n" +
                            "\t\t\t\t\t\t</th>\n" +
                            "\t\t\t\t\t\t<th>\n" +
                            "\t\t\t\t\t\t\t应用平台\n" +
                            "\t\t\t\t\t\t</th>\n" +
                            "\t\t\t\t\t\t<th>\n" +
                            "\t\t\t\t\t\t\t时间\n" +
                            "\t\t\t\t\t\t</th>\n" +
                            "\t\t\t\t\t\t<th>\n" +
                            "\t\t\t\t\t\t\t推送结果\n" +
                            "\t\t\t\t\t\t</th>\n" +
                            "\t\t\t\t\t</tr>\n" +
                            "\t\t\t\t</thead>\n" +
                            "\t\t\t</table>");
                        for(var i =0;i<msg.length;i++)
                        {
                            var k = "";
                            //console.log(msg[i]['status']);
                            switch (msg[i]['status']) {
                                case '01':
                                    k = "契约创建";
                                    break;
                                case "02":
                                    k = "数据归集";
                                    break;
                                case "03":
                                    k = "融合";
                                    break;
                                case "00":
                                    k = "推送成功";
                                    break;
                                default:
                                    k = "未知";
                                    break;

                            }
                            $("#table_ppp").append("<tr><th>"+msg[i]["xtrans"]+"</th><th>"+msg[i]['name']+"</th><th>"+msg[i]['app_name']+"</th><th>"+msg[i]['createdt']+"</th><th>"+k+"</th></tr>");
                        }
                        //evdata.data.btn.click();
                        $("#btn").click()
                    },
                    error:function(XMLHttpRequest,textStatus,errorThrown){
                        if(textStatus=="timeout"){
                            // $("#msg").append("<br>[超时]");
                            //evdata.data.btn.click();
                            $("#btn").click()
                        }
                    }

                });

            });

        });
    </script>

  </body>
</html>